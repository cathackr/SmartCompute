<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SmartCompute Industrial - Dashboard Visual</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/date-fns@2.29.3/index.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        :root {
            --primary: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --secondary: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            --success: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            --warning: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            --danger: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
            --dark: #2c3e50;
            --light: #ecf0f1;
            --shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
            --border-radius: 20px;
            --animation: cubic-bezier(0.25, 0.46, 0.45, 0.94);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 25%, #4b6cb7 50%, #182848 100%);
            min-height: 100vh;
            color: #333;
            overflow-x: hidden;
        }

        /* Particles background */
        .particles-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            opacity: 0.1;
        }

        .particle {
            position: absolute;
            background: white;
            border-radius: 50%;
            animation: float 6s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px) rotate(0deg); }
            33% { transform: translateY(-20px) rotate(120deg); }
            66% { transform: translateY(10px) rotate(240deg); }
        }

        /* Header épico */
        .mega-header {
            background: linear-gradient(135deg, rgba(255,255,255,0.95) 0%, rgba(255,255,255,0.85) 100%);
            border-radius: 25px;
            margin: 20px;
            padding: 40px;
            box-shadow: var(--shadow);
            position: relative;
            overflow: hidden;
        }

        .mega-header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 6px;
            background: linear-gradient(90deg, #ff6b6b, #feca57, #48dbfb, #ff9ff3, #54a0ff);
            animation: rainbow 3s linear infinite;
        }

        @keyframes rainbow {
            0% { background-position: 0% 50%; }
            100% { background-position: 100% 50%; }
        }

        .header-grid {
            display: grid;
            grid-template-columns: 1fr auto;
            gap: 30px;
            align-items: center;
        }

        .header-content h1 {
            font-size: 4em;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 15px;
            font-weight: 900;
            letter-spacing: -2px;
        }

        .header-content .subtitle {
            font-size: 1.4em;
            color: #666;
            margin-bottom: 20px;
            font-weight: 300;
        }

        .live-indicator {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 1.1em;
            font-weight: 600;
        }

        .pulse-dot {
            width: 12px;
            height: 12px;
            background: #ff4757;
            border-radius: 50%;
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.3); opacity: 0.7; }
            100% { transform: scale(1); opacity: 1; }
        }

        .status-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 15px;
        }

        .status-item {
            text-align: center;
            padding: 15px;
            background: rgba(255,255,255,0.5);
            border-radius: 15px;
            backdrop-filter: blur(10px);
        }

        .status-value {
            font-size: 2.5em;
            font-weight: 900;
            margin-bottom: 5px;
            background: var(--primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .status-label {
            font-size: 0.9em;
            color: #666;
            font-weight: 600;
        }

        /* KPI Cards épicos */
        .kpi-supergrid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 25px;
            margin: 30px 20px;
        }

        .kpi-mega-card {
            background: rgba(255,255,255,0.95);
            border-radius: var(--border-radius);
            padding: 30px;
            box-shadow: var(--shadow);
            position: relative;
            overflow: hidden;
            transition: all 0.4s var(--animation);
            cursor: pointer;
        }

        .kpi-mega-card:hover {
            transform: translateY(-10px) scale(1.02);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.2);
        }

        .kpi-mega-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: var(--primary);
        }

        .kpi-icon {
            width: 80px;
            height: 80px;
            background: var(--primary);
            border-radius: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.5em;
            color: white;
            margin-bottom: 20px;
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
        }

        .kpi-value {
            font-size: 3.5em;
            font-weight: 900;
            color: var(--dark);
            margin-bottom: 10px;
            line-height: 1;
        }

        .kpi-label {
            font-size: 1.2em;
            color: #666;
            font-weight: 600;
            margin-bottom: 15px;
        }

        .kpi-trend {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 1em;
            font-weight: 600;
        }

        .trend-up {
            color: #2ed573;
        }

        .trend-down {
            color: #ff4757;
        }

        .trend-stable {
            color: #ffa502;
        }

        /* Dashboard Grid */
        .dashboard-supergrid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(500px, 1fr));
            gap: 30px;
            margin: 20px;
        }

        .widget-card {
            background: rgba(255,255,255,0.95);
            border-radius: var(--border-radius);
            padding: 30px;
            box-shadow: var(--shadow);
            backdrop-filter: blur(15px);
            transition: all 0.3s var(--animation);
        }

        .widget-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.2);
        }

        .widget-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid #eee;
        }

        .widget-title {
            font-size: 1.6em;
            font-weight: 700;
            color: var(--dark);
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .widget-icon {
            font-size: 1.2em;
            padding: 8px;
            background: var(--primary);
            color: white;
            border-radius: 10px;
        }

        .widget-action {
            background: none;
            border: none;
            font-size: 1.4em;
            color: #666;
            cursor: pointer;
            padding: 8px;
            border-radius: 8px;
            transition: all 0.3s ease;
        }

        .widget-action:hover {
            background: #f8f9fa;
            color: var(--dark);
            transform: scale(1.1);
        }

        /* Charts */
        .chart-container {
            height: 400px;
            position: relative;
            margin: 20px 0;
        }

        .chart-mini {
            height: 200px;
        }

        /* Sensor Grid */
        .sensors-supergrid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .sensor-minicard {
            background: linear-gradient(135deg, rgba(255,255,255,0.9) 0%, rgba(255,255,255,0.7) 100%);
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            transition: all 0.3s ease;
            border-left: 4px solid;
            position: relative;
            overflow: hidden;
        }

        .sensor-minicard::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(45deg, transparent, rgba(255,255,255,0.3), transparent);
            transform: translateX(-100%);
            transition: transform 0.6s ease;
        }

        .sensor-minicard:hover::before {
            transform: translateX(100%);
        }

        .sensor-minicard:hover {
            transform: translateY(-5px) scale(1.05);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
        }

        .sensor-minicard.normal {
            border-color: #2ed573;
        }

        .sensor-minicard.warning {
            border-color: #ffa502;
        }

        .sensor-minicard.critical {
            border-color: #ff4757;
        }

        .sensor-icon {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .sensor-value {
            font-size: 2.2em;
            font-weight: 900;
            margin-bottom: 8px;
        }

        .sensor-label {
            font-size: 0.9em;
            color: #666;
            font-weight: 600;
        }

        /* Timeline Epic */
        .timeline-container {
            max-height: 450px;
            overflow-y: auto;
            padding-right: 10px;
        }

        .timeline-item {
            position: relative;
            padding: 20px 0 20px 60px;
            border-left: 3px solid #eee;
            margin-left: 20px;
        }

        .timeline-item::before {
            content: '';
            position: absolute;
            left: -12px;
            top: 25px;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: white;
            border: 4px solid;
            z-index: 1;
        }

        .timeline-item.critical::before {
            border-color: #ff4757;
            background: #ff4757;
        }

        .timeline-item.warning::before {
            border-color: #ffa502;
            background: #ffa502;
        }

        .timeline-item.info::before {
            border-color: #3742fa;
            background: #3742fa;
        }

        .timeline-item.success::before {
            border-color: #2ed573;
            background: #2ed573;
        }

        .timeline-content {
            background: rgba(255,255,255,0.8);
            border-radius: 12px;
            padding: 15px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
            transition: all 0.3s ease;
        }

        .timeline-content:hover {
            transform: translateX(5px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.12);
        }

        .timeline-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .timeline-title {
            font-weight: 700;
            font-size: 1.1em;
        }

        .timeline-time {
            font-size: 0.85em;
            color: #666;
            background: #f8f9fa;
            padding: 4px 8px;
            border-radius: 6px;
        }

        .timeline-description {
            color: #666;
            line-height: 1.5;
        }

        /* Loading States */
        .loading-shimmer {
            background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
            background-size: 200% 100%;
            animation: shimmer 1.5s infinite;
        }

        @keyframes shimmer {
            0% { background-position: -200% 0; }
            100% { background-position: 200% 0; }
        }

        /* Real-time indicators */
        .realtime-badge {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(255,255,255,0.95);
            padding: 15px 20px;
            border-radius: 25px;
            box-shadow: var(--shadow);
            display: flex;
            align-items: center;
            gap: 10px;
            font-weight: 600;
            z-index: 1000;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .header-content h1 {
                font-size: 2.5em;
            }

            .kpi-supergrid {
                grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
                gap: 15px;
            }

            .dashboard-supergrid {
                grid-template-columns: 1fr;
                gap: 20px;
            }

            .chart-container {
                height: 300px;
            }
        }

        /* Notifications */
        .notification {
            position: fixed;
            top: 100px;
            right: 20px;
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: var(--shadow);
            z-index: 1001;
            transform: translateX(400px);
            transition: transform 0.4s var(--animation);
            max-width: 300px;
        }

        .notification.show {
            transform: translateX(0);
        }

        .notification.critical {
            border-left: 5px solid #ff4757;
        }

        .notification.warning {
            border-left: 5px solid #ffa502;
        }

        .notification.info {
            border-left: 5px solid #3742fa;
        }

        /* Scrollbar personalizado */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(255,255,255,0.1);
            border-radius: 10px;
        }

        ::-webkit-scrollbar-thumb {
            background: rgba(255,255,255,0.3);
            border-radius: 10px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: rgba(255,255,255,0.5);
        }

        /* BotConf 2024 Widget Styles */
        .botconf-widget {
            background: linear-gradient(135deg, rgba(147, 51, 234, 0.05) 0%, rgba(79, 70, 229, 0.05) 100%);
            border: 2px solid rgba(147, 51, 234, 0.2);
            position: relative;
            overflow: hidden;
        }

        .botconf-widget::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #9333ea, #4f46e5, #06b6d4);
            animation: botconf-glow 3s ease-in-out infinite;
        }

        @keyframes botconf-glow {
            0%, 100% { opacity: 0.7; }
            50% { opacity: 1; }
        }

        .botconf-icon {
            background: linear-gradient(135deg, #9333ea 0%, #4f46e5 100%);
            animation: pulse-icon 2s infinite;
        }

        @keyframes pulse-icon {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        .botconf-badge {
            display: flex;
            gap: 8px;
        }

        .research-badge {
            background: #9333ea;
            color: white;
            padding: 4px 8px;
            border-radius: 8px;
            font-size: 0.7em;
            font-weight: 700;
            letter-spacing: 0.5px;
        }

        .active-badge {
            background: #10b981;
            color: white;
            padding: 4px 8px;
            border-radius: 8px;
            font-size: 0.7em;
            font-weight: 700;
            position: relative;
        }

        .active-badge::before {
            content: '';
            position: absolute;
            left: -2px;
            top: 50%;
            transform: translateY(-50%);
            width: 6px;
            height: 6px;
            background: #10b981;
            border-radius: 50%;
            animation: pulse 1.5s infinite;
        }

        .em-analysis-container {
            margin-top: 20px;
        }

        .em-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid rgba(147, 51, 234, 0.1);
        }

        .confidence-score {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .confidence-label {
            font-size: 0.9em;
            color: #666;
        }

        .confidence-value {
            font-size: 1.3em;
            font-weight: 700;
            color: #10b981;
        }

        .frequency-bands {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 25px;
        }

        .band-item {
            background: rgba(255, 255, 255, 0.8);
            border-radius: 10px;
            padding: 15px;
            text-align: center;
            border: 2px solid transparent;
            transition: all 0.3s ease;
        }

        .band-item:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .band-item.normal {
            border-color: #10b981;
        }

        .band-item.warning {
            border-color: #f59e0b;
            background: rgba(245, 158, 11, 0.05);
        }

        .band-item.critical {
            border-color: #ef4444;
            background: rgba(239, 68, 68, 0.05);
        }

        .band-label {
            font-size: 0.85em;
            color: #666;
            margin-bottom: 5px;
        }

        .band-value {
            font-size: 1.4em;
            font-weight: 700;
            color: #333;
            margin-bottom: 5px;
        }

        .band-status {
            font-size: 0.8em;
            font-weight: 600;
        }

        .em-signatures {
            margin-bottom: 25px;
        }

        .signatures-grid {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-top: 10px;
        }

        .signature-item {
            display: flex;
            align-items: center;
            padding: 12px;
            background: rgba(255, 255, 255, 0.6);
            border-radius: 8px;
            transition: all 0.3s ease;
        }

        .signature-item:hover {
            background: rgba(255, 255, 255, 0.9);
            transform: translateX(5px);
        }

        .signature-item.warning {
            background: rgba(245, 158, 11, 0.1);
            border-left: 4px solid #f59e0b;
        }

        .signature-icon {
            font-size: 1.5em;
            margin-right: 12px;
        }

        .signature-info {
            flex: 1;
        }

        .signature-name {
            font-weight: 600;
            color: #333;
            margin-bottom: 2px;
        }

        .signature-details {
            font-size: 0.85em;
            color: #666;
        }

        .signature-status {
            font-size: 1.2em;
            font-weight: bold;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .signature-status.normal {
            background: #d1fae5;
            color: #065f46;
        }

        .signature-status.warning {
            background: #fef3c7;
            color: #92400e;
        }

        .em-chart-container {
            height: 250px;
            margin: 20px 0;
            background: rgba(255, 255, 255, 0.5);
            border-radius: 10px;
            padding: 15px;
        }

        .research-info {
            background: linear-gradient(135deg, rgba(147, 51, 234, 0.05) 0%, rgba(79, 70, 229, 0.05) 100%);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 20px;
        }

        .research-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .research-authors {
            display: flex;
            gap: 8px;
            font-size: 0.8em;
        }

        .research-authors span {
            background: rgba(147, 51, 234, 0.1);
            padding: 3px 8px;
            border-radius: 12px;
            color: #7c3aed;
            font-weight: 500;
        }

        .research-details {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .research-paper {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .paper-title {
            font-style: italic;
            color: #4f46e5;
            font-weight: 500;
        }

        .paper-venue {
            background: #4f46e5;
            color: white;
            padding: 2px 8px;
            border-radius: 8px;
            font-size: 0.8em;
            font-weight: 600;
        }

        .implementation-info {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .impl-label {
            font-size: 0.9em;
            color: #666;
        }

        .impl-author {
            background: #10b981;
            color: white;
            padding: 2px 8px;
            border-radius: 8px;
            font-size: 0.8em;
            font-weight: 600;
        }

        .detection-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
            gap: 15px;
            padding: 15px;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 10px;
        }

        .stat-item {
            text-align: center;
        }

        .stat-value {
            font-size: 1.8em;
            font-weight: 700;
            color: #4f46e5;
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 0.85em;
            color: #666;
            font-weight: 500;
        }
    </style>
</head>
<body>
    <!-- Particles Background -->
    <div class="particles-container" id="particles"></div>

    <!-- Real-time Badge -->
    <div class="realtime-badge">
        <div class="pulse-dot"></div>
        <span>EN VIVO</span>
        <span id="lastUpdate">--:--</span>
    </div>

    <!-- Mega Header -->
    <div class="mega-header">
        <div class="header-grid">
            <div class="header-content">
                <h1>🏭 SmartCompute Industrial</h1>
                <div class="subtitle">Dashboard Visual Interactivo con Streaming en Tiempo Real</div>
                <div class="live-indicator">
                    <div class="pulse-dot"></div>
                    <span>Sistema Operacional</span>
                    <span id="currentTime"></span>
                </div>
            </div>
            <div class="status-grid">
                <div class="status-item">
                    <div class="status-value" id="systemsOnline">--</div>
                    <div class="status-label">Sistemas</div>
                </div>
                <div class="status-item">
                    <div class="status-value" id="efficiency">--%</div>
                    <div class="status-label">Eficiencia</div>
                </div>
                <div class="status-item">
                    <div class="status-value" id="activeAlerts">--</div>
                    <div class="status-label">Alertas</div>
                </div>
                <div class="status-item">
                    <div class="status-value" id="uptime">--%</div>
                    <div class="status-label">Uptime</div>
                </div>
            </div>
        </div>
    </div>

    <!-- KPI Super Grid -->
    <div class="kpi-supergrid">
        <div class="kpi-mega-card" data-category="sensors">
            <div class="kpi-icon">
                <i class="fas fa-thermometer-half"></i>
            </div>
            <div class="kpi-value" id="temperatureValue">--°C</div>
            <div class="kpi-label">Temperatura Reactor</div>
            <div class="kpi-trend trend-stable">
                <i class="fas fa-minus"></i>
                <span>Estable</span>
            </div>
        </div>

        <div class="kpi-mega-card" data-category="pressure">
            <div class="kpi-icon">
                <i class="fas fa-tachometer-alt"></i>
            </div>
            <div class="kpi-value" id="pressureValue">-- bar</div>
            <div class="kpi-label">Presión Hidráulica</div>
            <div class="kpi-trend trend-up">
                <i class="fas fa-arrow-up"></i>
                <span>Subiendo</span>
            </div>
        </div>

        <div class="kpi-mega-card" data-category="flow">
            <div class="kpi-icon">
                <i class="fas fa-water"></i>
            </div>
            <div class="kpi-value" id="flowValue">-- L/min</div>
            <div class="kpi-label">Flujo de Agua</div>
            <div class="kpi-trend trend-stable">
                <i class="fas fa-minus"></i>
                <span>Normal</span>
            </div>
        </div>

        <div class="kpi-mega-card" data-category="power">
            <div class="kpi-icon">
                <i class="fas fa-bolt"></i>
            </div>
            <div class="kpi-value" id="voltageValue">-- V</div>
            <div class="kpi-label">Voltaje Motor A</div>
            <div class="kpi-trend trend-down">
                <i class="fas fa-arrow-down"></i>
                <span>Bajando</span>
            </div>
        </div>
    </div>

    <!-- Dashboard Super Grid -->
    <div class="dashboard-supergrid">
        <!-- Sensors Real-time -->
        <div class="widget-card">
            <div class="widget-header">
                <div class="widget-title">
                    <div class="widget-icon">
                        <i class="fas fa-sensors"></i>
                    </div>
                    Sensores en Tiempo Real
                </div>
                <button class="widget-action" onclick="refreshSensors()">
                    <i class="fas fa-sync-alt"></i>
                </button>
            </div>
            <div class="sensors-supergrid" id="sensorsGrid">
                <!-- Sensores se cargan dinámicamente -->
            </div>
        </div>

        <!-- Charts -->
        <div class="widget-card">
            <div class="widget-header">
                <div class="widget-title">
                    <div class="widget-icon">
                        <i class="fas fa-chart-line"></i>
                    </div>
                    Tendencias en Tiempo Real
                </div>
                <button class="widget-action" onclick="toggleChartType()">
                    <i class="fas fa-exchange-alt"></i>
                </button>
            </div>
            <div class="chart-container">
                <canvas id="trendsChart"></canvas>
            </div>
        </div>

        <!-- PLCs Status -->
        <div class="widget-card">
            <div class="widget-header">
                <div class="widget-title">
                    <div class="widget-icon">
                        <i class="fas fa-microchip"></i>
                    </div>
                    Estado de PLCs
                </div>
                <button class="widget-action" onclick="refreshPLCs()">
                    <i class="fas fa-sync-alt"></i>
                </button>
            </div>
            <div id="plcsContainer">
                <!-- PLCs se cargan dinámicamente -->
            </div>
        </div>

        <!-- Timeline de eventos -->
        <div class="widget-card">
            <div class="widget-header">
                <div class="widget-title">
                    <div class="widget-icon">
                        <i class="fas fa-clock"></i>
                    </div>
                    Timeline de Eventos
                </div>
                <button class="widget-action" onclick="clearTimeline()">
                    <i class="fas fa-trash"></i>
                </button>
            </div>
            <div class="timeline-container" id="eventsTimeline">
                <!-- Timeline se carga dinámicamente -->
            </div>
        </div>

        <!-- Protocolos Industriales -->
        <div class="widget-card">
            <div class="widget-header">
                <div class="widget-title">
                    <div class="widget-icon">
                        <i class="fas fa-network-wired"></i>
                    </div>
                    Protocolos Industriales
                </div>
                <button class="widget-action" onclick="scanProtocols()">
                    <i class="fas fa-search"></i>
                </button>
            </div>
            <div id="protocolsContainer">
                <!-- Protocolos se cargan dinámicamente -->
            </div>
        </div>

        <!-- Análisis Predictivo -->
        <div class="widget-card">
            <div class="widget-header">
                <div class="widget-title">
                    <div class="widget-icon">
                        <i class="fas fa-crystal-ball"></i>
                    </div>
                    Análisis Predictivo MLE-STAR
                </div>
                <button class="widget-action" onclick="runPrediction()">
                    <i class="fas fa-play"></i>
                </button>
            </div>
            <div class="chart-container chart-mini">
                <canvas id="predictionChart"></canvas>
            </div>
        </div>

        <!-- BotConf 2024 Security Widget -->
        <div class="widget-card botconf-widget">
            <div class="widget-header">
                <div class="widget-title">
                    <div class="widget-icon botconf-icon">
                        <i class="fas fa-shield-virus"></i>
                    </div>
                    🔬 BotConf 2024 - Detección Electromagnética
                </div>
                <div class="botconf-badge">
                    <span class="research-badge">RESEARCH</span>
                    <span class="active-badge">ACTIVO</span>
                </div>
            </div>

            <!-- EM Spectrum Analysis -->
            <div class="em-analysis-container">
                <div class="em-header">
                    <h4>🌊 Análisis del Espectro Electromagnético</h4>
                    <div class="confidence-score">
                        <span class="confidence-label">Confianza:</span>
                        <span class="confidence-value" id="emConfidence">94.7%</span>
                    </div>
                </div>

                <!-- Frequency Bands -->
                <div class="frequency-bands">
                    <div class="band-item normal">
                        <div class="band-label">RF Low (0-30 MHz)</div>
                        <div class="band-value" id="rfLow">-42 dBm</div>
                        <div class="band-status">🟢 Normal</div>
                    </div>
                    <div class="band-item warning">
                        <div class="band-label">RF Mid (30-300 MHz)</div>
                        <div class="band-value" id="rfMid">-38 dBm</div>
                        <div class="band-status">🟡 Elevated</div>
                    </div>
                    <div class="band-item normal">
                        <div class="band-label">RF High (300-3000 MHz)</div>
                        <div class="band-value" id="rfHigh">-45 dBm</div>
                        <div class="band-status">🟢 Normal</div>
                    </div>
                </div>

                <!-- EM Signature Detection -->
                <div class="em-signatures">
                    <h5>🔍 Firmas Electromagnéticas Detectadas</h5>
                    <div class="signatures-grid">
                        <div class="signature-item">
                            <div class="signature-icon">📱</div>
                            <div class="signature-info">
                                <div class="signature-name">IoT Device Pattern</div>
                                <div class="signature-details">3 dispositivos • Normal</div>
                            </div>
                            <div class="signature-status normal">✓</div>
                        </div>
                        <div class="signature-item">
                            <div class="signature-icon">🤖</div>
                            <div class="signature-info">
                                <div class="signature-name">PLC Communication</div>
                                <div class="signature-details">Modbus/PROFINET • Activo</div>
                            </div>
                            <div class="signature-status normal">✓</div>
                        </div>
                        <div class="signature-item warning" id="anomalousSignature">
                            <div class="signature-icon">⚠️</div>
                            <div class="signature-info">
                                <div class="signature-name">Anomalous Pattern</div>
                                <div class="signature-details">Frecuencia inusual • Investigando</div>
                            </div>
                            <div class="signature-status warning">!</div>
                        </div>
                    </div>
                </div>

                <!-- Real-time EM Chart -->
                <div class="em-chart-container">
                    <canvas id="emSpectrumChart"></canvas>
                </div>

                <!-- BOTCONF Research Info -->
                <div class="research-info">
                    <div class="research-header">
                        <h5>📚 Investigación Base</h5>
                        <div class="research-authors">
                            <span>👨‍🔬 Duy-Phuc Pham</span>
                            <span>👩‍🔬 Damien Marion</span>
                            <span>👩‍🔬 Annelie Heuser</span>
                        </div>
                    </div>
                    <div class="research-details">
                        <div class="research-paper">
                            <span class="paper-title">"Electromagnetic-based Malware Detection for IoT Devices"</span>
                            <span class="paper-venue">BOTCONF 2024</span>
                        </div>
                        <div class="implementation-info">
                            <span class="impl-label">Implementación Comercial:</span>
                            <span class="impl-author">Martín Iribarne (CEH)</span>
                        </div>
                    </div>
                </div>

                <!-- Detection Statistics -->
                <div class="detection-stats">
                    <div class="stat-item">
                        <div class="stat-value" id="totalScans">2,847</div>
                        <div class="stat-label">Escaneos EM</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="threatsDetected">3</div>
                        <div class="stat-label">Amenazas</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="falsePositives">0.2%</div>
                        <div class="stat-label">Falsos Positivos</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="avgResponseTime">0.8s</div>
                        <div class="stat-label">Tiempo Respuesta</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Notification Container -->
    <div class="notification" id="notification">
        <div id="notificationContent"></div>
    </div>

    <script>
        // Global variables
        let charts = {};
        let eventHistory = [];
        let currentData = null;
        let chartType = 'line';

        // Initialize dashboard
        document.addEventListener('DOMContentLoaded', function() {
            console.log('🚀 SmartCompute Visual Dashboard con BotConf 2024 Iniciado');

            initializeParticles();
            initializeCharts();
            initializeEMChart(); // Initialize BotConf EM chart
            startDataFeed();
            updateTime();

            // Update time every second
            setInterval(updateTime, 1000);

            // Start EM data updates every 5 seconds
            setInterval(updateEMData, 5000);
            updateEMData(); // Initial EM update
        });

        function initializeParticles() {
            const container = document.getElementById('particles');
            const particleCount = 50;

            for (let i = 0; i < particleCount; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';

                const size = Math.random() * 4 + 2;
                particle.style.width = size + 'px';
                particle.style.height = size + 'px';

                particle.style.left = Math.random() * 100 + '%';
                particle.style.top = Math.random() * 100 + '%';

                particle.style.animationDelay = Math.random() * 6 + 's';
                particle.style.animationDuration = (Math.random() * 4 + 4) + 's';

                container.appendChild(particle);
            }
        }

        function updateTime() {
            const now = new Date();
            document.getElementById('currentTime').textContent = now.toLocaleTimeString();
            document.getElementById('lastUpdate').textContent = now.toLocaleTimeString();
        }

        function initializeCharts() {
            // Trends Chart
            const trendsCtx = document.getElementById('trendsChart').getContext('2d');
            charts.trends = new Chart(trendsCtx, {
                type: 'line',
                data: {
                    labels: [],
                    datasets: [
                        {
                            label: 'Temperatura (°C)',
                            data: [],
                            borderColor: '#ff6b6b',
                            backgroundColor: 'rgba(255, 107, 107, 0.1)',
                            tension: 0.4,
                            fill: true
                        },
                        {
                            label: 'Presión (bar)',
                            data: [],
                            borderColor: '#4ecdc4',
                            backgroundColor: 'rgba(78, 205, 196, 0.1)',
                            tension: 0.4,
                            fill: true
                        },
                        {
                            label: 'Flujo (L/min)',
                            data: [],
                            borderColor: '#45b7d1',
                            backgroundColor: 'rgba(69, 183, 209, 0.1)',
                            tension: 0.4,
                            fill: true
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: {
                                color: 'rgba(0,0,0,0.1)'
                            }
                        },
                        x: {
                            grid: {
                                color: 'rgba(0,0,0,0.1)'
                            }
                        }
                    },
                    animation: {
                        duration: 750,
                        easing: 'easeInOutQuart'
                    }
                }
            });

            // Prediction Chart
            const predictionCtx = document.getElementById('predictionChart').getContext('2d');
            charts.prediction = new Chart(predictionCtx, {
                type: 'doughnut',
                data: {
                    labels: ['Óptimo', 'Warning', 'Crítico'],
                    datasets: [{
                        data: [70, 25, 5],
                        backgroundColor: ['#2ed573', '#ffa502', '#ff4757'],
                        borderWidth: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });
        }

        async function startDataFeed() {
            console.log('📡 Iniciando feed de datos...');

            // Polling cada 2 segundos
            setInterval(fetchData, 2000);

            // Primera carga
            await fetchData();
        }

        async function fetchData() {
            try {
                const response = await fetch('live_data.json');
                const data = await response.json();

                currentData = data;
                updateDashboard(data);

            } catch (error) {
                console.error('Error fetching data:', error);
                // Fallback to simulated data
                const simulatedData = generateSimulatedData();
                updateDashboard(simulatedData);
            }
        }

        function updateDashboard(data) {
            // Update header stats
            document.getElementById('systemsOnline').textContent = data.metrics?.systems_online || '--';
            document.getElementById('efficiency').textContent = (data.metrics?.efficiency || '--') + '%';
            document.getElementById('activeAlerts').textContent = data.alerts?.length || 0;
            document.getElementById('uptime').textContent = (data.metrics?.uptime_percentage || '--') + '%';

            // Update BotConf 2024 EM data if available
            if (data.botconf_2024?.electromagnetic_analysis) {
                const emData = data.botconf_2024.electromagnetic_analysis;

                if (document.getElementById('emConfidence')) {
                    document.getElementById('emConfidence').textContent = emData.confidence_score + '%';
                }

                if (emData.rf_bands) {
                    if (document.getElementById('rfLow')) {
                        document.getElementById('rfLow').textContent = emData.rf_bands.low_0_30mhz + ' dBm';
                    }
                    if (document.getElementById('rfMid')) {
                        document.getElementById('rfMid').textContent = emData.rf_bands.mid_30_300mhz + ' dBm';
                    }
                    if (document.getElementById('rfHigh')) {
                        document.getElementById('rfHigh').textContent = emData.rf_bands.high_300_3000mhz + ' dBm';
                    }
                }

                if (emData.statistics) {
                    if (document.getElementById('totalScans')) {
                        document.getElementById('totalScans').textContent = emData.statistics.total_scans.toLocaleString();
                    }
                    if (document.getElementById('threatsDetected')) {
                        document.getElementById('threatsDetected').textContent = emData.statistics.threats_detected;
                    }
                    if (document.getElementById('falsePositives')) {
                        document.getElementById('falsePositives').textContent = emData.statistics.false_positive_rate + '%';
                    }
                    if (document.getElementById('avgResponseTime')) {
                        document.getElementById('avgResponseTime').textContent = emData.statistics.avg_response_time + 's';
                    }
                }

                // Show/hide anomalous signature based on detection
                const anomalousSignature = document.getElementById('anomalousSignature');
                if (anomalousSignature && emData.signatures_detected?.anomalous_patterns > 0) {
                    anomalousSignature.style.display = 'flex';
                    if (emData.signatures_detected.anomalous_patterns > 1) {
                        showNotification('🔬 BotConf: Múltiples patrones electromagnéticos anómalos detectados', 'warning');
                    }
                } else if (anomalousSignature) {
                    anomalousSignature.style.display = 'none';
                }
            }

            // Update KPIs
            if (data.sensors) {
                document.getElementById('temperatureValue').textContent =
                    (data.sensors.temperature_reactor?.toFixed(1) || '--') + '°C';
                document.getElementById('pressureValue').textContent =
                    (data.sensors.pressure_hydraulic?.toFixed(1) || '--') + ' bar';
                document.getElementById('flowValue').textContent =
                    (data.sensors.flow_water?.toFixed(1) || '--') + ' L/min';
                document.getElementById('voltageValue').textContent =
                    (data.sensors.voltage_motor_a?.toFixed(0) || '--') + ' V';
            }

            // Update sensors grid
            updateSensorsGrid(data.sensors || {});

            // Update PLCs
            updatePLCsContainer(data.plcs || {});

            // Update protocols
            updateProtocolsContainer(data.protocols || {});

            // Update charts
            updateTrendsChart(data);

            // Update timeline
            updateTimeline(data.alerts || []);

            // Check for new alerts
            checkForAlerts(data.alerts || []);
        }

        function updateSensorsGrid(sensors) {
            const grid = document.getElementById('sensorsGrid');
            grid.innerHTML = '';

            const sensorIcons = {
                temperature: 'fas fa-thermometer-half',
                pressure: 'fas fa-tachometer-alt',
                flow: 'fas fa-water',
                voltage: 'fas fa-bolt',
                current: 'fas fa-zap',
                vibration: 'fas fa-wave-square',
                speed: 'fas fa-tachometer-alt',
                humidity: 'fas fa-tint'
            };

            Object.entries(sensors).forEach(([sensorName, value]) => {
                const sensorType = sensorName.split('_')[0];
                const icon = sensorIcons[sensorType] || 'fas fa-sensor';

                let status = 'normal';
                if (sensorType === 'temperature' && value > 75) status = 'warning';
                if (sensorType === 'temperature' && value > 80) status = 'critical';
                if (sensorType === 'pressure' && value > 40) status = 'warning';
                if (sensorType === 'pressure' && value > 45) status = 'critical';

                const sensorCard = document.createElement('div');
                sensorCard.className = `sensor-minicard ${status}`;
                sensorCard.innerHTML = `
                    <div class="sensor-icon"><i class="${icon}"></i></div>
                    <div class="sensor-value">${value.toFixed(1)}</div>
                    <div class="sensor-label">${sensorName.replace(/_/g, ' ').toUpperCase()}</div>
                `;

                grid.appendChild(sensorCard);
            });
        }

        function updatePLCsContainer(plcs) {
            const container = document.getElementById('plcsContainer');
            container.innerHTML = '';

            Object.entries(plcs).forEach(([plcName, plcData]) => {
                const plcDiv = document.createElement('div');
                plcDiv.style.cssText = `
                    display: grid;
                    grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
                    gap: 15px;
                    padding: 20px;
                    background: rgba(255,255,255,0.5);
                    border-radius: 12px;
                    margin-bottom: 15px;
                `;

                const cpuStatus = plcData.cpu_load > 80 ? 'critical' : plcData.cpu_load > 60 ? 'warning' : 'normal';
                const memStatus = plcData.memory_usage > 80 ? 'critical' : plcData.memory_usage > 60 ? 'warning' : 'normal';

                plcDiv.innerHTML = `
                    <div style="text-align: center;">
                        <div style="font-size: 2em; color: #666; margin-bottom: 5px;">
                            <i class="fas fa-microchip"></i>
                        </div>
                        <div style="font-weight: 700; color: #333;">${plcName}</div>
                        <div style="font-size: 0.9em; color: #666;">${plcData.status.toUpperCase()}</div>
                    </div>
                    <div style="text-align: center;">
                        <div style="font-size: 1.8em; font-weight: 700; color: ${cpuStatus === 'critical' ? '#ff4757' : cpuStatus === 'warning' ? '#ffa502' : '#2ed573'};">
                            ${plcData.cpu_load.toFixed(1)}%
                        </div>
                        <div style="font-size: 0.9em; color: #666;">CPU Load</div>
                    </div>
                    <div style="text-align: center;">
                        <div style="font-size: 1.8em; font-weight: 700; color: ${memStatus === 'critical' ? '#ff4757' : memStatus === 'warning' ? '#ffa502' : '#2ed573'};">
                            ${plcData.memory_usage.toFixed(1)}%
                        </div>
                        <div style="font-size: 0.9em; color: #666;">Memory</div>
                    </div>
                    <div style="text-align: center;">
                        <div style="font-size: 1.8em; font-weight: 700; color: #3742fa;">
                            ${plcData.network_latency.toFixed(1)}ms
                        </div>
                        <div style="font-size: 0.9em; color: #666;">Latency</div>
                    </div>
                `;

                container.appendChild(plcDiv);
            });
        }

        function updateProtocolsContainer(protocols) {
            const container = document.getElementById('protocolsContainer');
            container.innerHTML = '';

            Object.entries(protocols).forEach(([protoName, protoData]) => {
                const protoDiv = document.createElement('div');
                protoDiv.style.cssText = `
                    display: flex;
                    justify-content: space-between;
                    align-items: center;
                    padding: 15px;
                    background: rgba(255,255,255,0.5);
                    border-radius: 10px;
                    margin-bottom: 10px;
                    border-left: 4px solid ${protoData.status === 'online' ? '#2ed573' : protoData.status === 'warning' ? '#ffa502' : '#ff4757'};
                `;

                protoDiv.innerHTML = `
                    <div>
                        <div style="font-weight: 700; color: #333; margin-bottom: 5px;">
                            ${protoName.toUpperCase().replace('_', ' ')}
                        </div>
                        <div style="font-size: 0.9em; color: #666;">
                            ${protoData.connections_per_second.toFixed(1)} conn/s | ${protoData.latency_ms.toFixed(1)}ms
                        </div>
                    </div>
                    <div style="text-align: right;">
                        <div style="font-size: 1.2em; color: ${protoData.status === 'online' ? '#2ed573' : protoData.status === 'warning' ? '#ffa502' : '#ff4757'};">
                            <i class="fas fa-circle"></i>
                        </div>
                        <div style="font-size: 0.8em; color: #666;">
                            ${protoData.status.toUpperCase()}
                        </div>
                    </div>
                `;

                container.appendChild(protoDiv);
            });
        }

        function updateTrendsChart(data) {
            if (!charts.trends || !data.sensors) return;

            const now = new Date();
            const timeLabel = now.toLocaleTimeString();

            // Mantener solo los últimos 20 puntos de datos
            if (charts.trends.data.labels.length >= 20) {
                charts.trends.data.labels.shift();
                charts.trends.data.datasets.forEach(dataset => dataset.data.shift());
            }

            charts.trends.data.labels.push(timeLabel);
            charts.trends.data.datasets[0].data.push(data.sensors.temperature_reactor || 0);
            charts.trends.data.datasets[1].data.push(data.sensors.pressure_hydraulic || 0);
            charts.trends.data.datasets[2].data.push(data.sensors.flow_water || 0);

            charts.trends.update('none');
        }

        function updateTimeline(alerts) {
            const timeline = document.getElementById('eventsTimeline');

            // Agregar nuevas alertas al historial
            alerts.forEach(alert => {
                if (!eventHistory.some(e => e.timestamp === alert.timestamp && e.message === alert.message)) {
                    eventHistory.unshift({
                        ...alert,
                        type: 'alert'
                    });
                }
            });

            // Agregar eventos del sistema ocasionalmente
            if (Math.random() < 0.1) {
                eventHistory.unshift({
                    level: 'info',
                    message: 'Sistema operando normalmente',
                    timestamp: new Date().toISOString(),
                    source: 'system',
                    type: 'status'
                });
            }

            // Mantener solo los últimos 10 eventos
            eventHistory = eventHistory.slice(0, 10);

            // Renderizar timeline
            timeline.innerHTML = '';
            eventHistory.forEach(event => {
                const eventDiv = document.createElement('div');
                eventDiv.className = `timeline-item ${event.level}`;

                const levelIcon = {
                    critical: 'fas fa-exclamation-triangle',
                    warning: 'fas fa-exclamation-circle',
                    info: 'fas fa-info-circle',
                    success: 'fas fa-check-circle'
                };

                eventDiv.innerHTML = `
                    <div class="timeline-content">
                        <div class="timeline-header">
                            <div class="timeline-title">
                                <i class="${levelIcon[event.level] || 'fas fa-info'}"></i>
                                ${event.message}
                            </div>
                            <div class="timeline-time">
                                ${new Date(event.timestamp).toLocaleTimeString()}
                            </div>
                        </div>
                        <div class="timeline-description">
                            Fuente: ${event.source || 'Sistema'}
                            ${event.value ? ` | Valor: ${event.value}` : ''}
                        </div>
                    </div>
                `;

                timeline.appendChild(eventDiv);
            });
        }

        function checkForAlerts(alerts) {
            alerts.forEach(alert => {
                if (alert.level === 'critical') {
                    showNotification(alert.message, 'critical');
                }
            });
        }

        function showNotification(message, type = 'info') {
            const notification = document.getElementById('notification');
            const content = document.getElementById('notificationContent');

            const icons = {
                critical: 'fas fa-exclamation-triangle',
                warning: 'fas fa-exclamation-circle',
                info: 'fas fa-info-circle'
            };

            content.innerHTML = `
                <div style="display: flex; align-items: center; gap: 10px;">
                    <i class="${icons[type]}" style="font-size: 1.5em; color: ${type === 'critical' ? '#ff4757' : type === 'warning' ? '#ffa502' : '#3742fa'};"></i>
                    <div>
                        <div style="font-weight: 600; margin-bottom: 5px;">
                            ${type === 'critical' ? 'Alerta Crítica' : type === 'warning' ? 'Advertencia' : 'Información'}
                        </div>
                        <div style="color: #666;">${message}</div>
                    </div>
                </div>
            `;

            notification.className = `notification ${type} show`;

            setTimeout(() => {
                notification.classList.remove('show');
            }, 5000);
        }

        function generateSimulatedData() {
            const now = new Date();
            return {
                timestamp: now.toISOString(),
                sensors: {
                    temperature_reactor: 70 + Math.random() * 20,
                    pressure_hydraulic: 20 + Math.random() * 10,
                    flow_water: 35 + Math.random() * 15,
                    voltage_motor_a: 220 + Math.random() * 20,
                    current_pump: 8 + Math.random() * 4,
                    vibration_axis: 5 + Math.random() * 3,
                    speed_motor: 1600 + Math.random() * 400,
                    humidity_ambient: 50 + Math.random() * 20
                },
                plcs: {
                    PLC_001: {
                        status: 'online',
                        cpu_load: 45 + Math.random() * 30,
                        memory_usage: 60 + Math.random() * 20,
                        network_latency: 12 + Math.random() * 10,
                        error_count: Math.floor(Math.random() * 3)
                    },
                    PLC_002: {
                        status: 'online',
                        cpu_load: 38 + Math.random() * 25,
                        memory_usage: 55 + Math.random() * 15,
                        network_latency: 8 + Math.random() * 8,
                        error_count: Math.floor(Math.random() * 2)
                    }
                },
                protocols: {
                    modbus_tcp: {
                        status: 'online',
                        connections_per_second: 90 + Math.random() * 20,
                        latency_ms: 10 + Math.random() * 5,
                        error_rate: Math.random() * 0.5
                    },
                    profinet: {
                        status: 'online',
                        connections_per_second: 75 + Math.random() * 15,
                        latency_ms: 8 + Math.random() * 4,
                        error_rate: Math.random() * 0.3
                    },
                    opc_ua: {
                        status: Math.random() > 0.7 ? 'warning' : 'online',
                        connections_per_second: 15 + Math.random() * 10,
                        latency_ms: 35 + Math.random() * 20,
                        error_rate: Math.random() * 0.8
                    }
                },
                alerts: [],
                metrics: {
                    efficiency: 85 + Math.random() * 15,
                    systems_online: 5 + Math.floor(Math.random() * 2),
                    total_systems: 6,
                    uptime_percentage: 99 + Math.random() * 1
                }
            };
        }

        // Interactive functions
        function refreshSensors() {
            showNotification('Actualizando sensores...', 'info');
            setTimeout(() => fetchData(), 500);
        }

        function refreshPLCs() {
            showNotification('Escaneando PLCs...', 'info');
            setTimeout(() => fetchData(), 800);
        }

        function scanProtocols() {
            showNotification('Escaneando protocolos industriales...', 'info');
            setTimeout(() => fetchData(), 1000);
        }

        function toggleChartType() {
            chartType = chartType === 'line' ? 'bar' : 'line';
            charts.trends.config.type = chartType;
            charts.trends.update();
            showNotification(`Gráfico cambiado a ${chartType}`, 'info');
        }

        function runPrediction() {
            showNotification('Ejecutando análisis predictivo MLE-STAR...', 'info');

            // Simular predicción
            setTimeout(() => {
                const prediction = {
                    optimal: Math.random() * 30 + 50,
                    warning: Math.random() * 20 + 20,
                    critical: Math.random() * 10 + 5
                };

                charts.prediction.data.datasets[0].data = [prediction.optimal, prediction.warning, prediction.critical];
                charts.prediction.update();

                showNotification(`Predicción completada: ${prediction.optimal.toFixed(1)}% óptimo`, 'info');
            }, 2000);
        }

        function clearTimeline() {
            eventHistory = [];
            document.getElementById('eventsTimeline').innerHTML = '';
            showNotification('Timeline limpiado', 'info');
        }

        // Window resize handler
        window.addEventListener('resize', function() {
            Object.values(charts).forEach(chart => {
                if (chart && chart.resize) {
                    chart.resize();
                }
            });
        });

        // Initialize EM Spectrum Chart for BotConf widget
        function initializeEMChart() {
            const ctx = document.getElementById('emSpectrumChart');
            if (!ctx) return;

            const ctxCanvas = ctx.getContext('2d');

            // Simulated electromagnetic spectrum data
            const frequencyLabels = ['1MHz', '10MHz', '100MHz', '1GHz', '2.4GHz', '5GHz'];
            const normalPattern = [-45, -42, -38, -35, -40, -45];
            const currentPattern = [-44, -41, -38, -36, -39, -46];

            charts.emSpectrum = new Chart(ctxCanvas, {
                type: 'line',
                data: {
                    labels: frequencyLabels,
                    datasets: [{
                        label: 'Patrón Normal (dBm)',
                        data: normalPattern,
                        borderColor: '#10b981',
                        backgroundColor: 'rgba(16, 185, 129, 0.1)',
                        tension: 0.4,
                        fill: true
                    }, {
                        label: 'Lectura Actual (dBm)',
                        data: currentPattern,
                        borderColor: '#4f46e5',
                        backgroundColor: 'rgba(79, 70, 229, 0.1)',
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: '🌊 Espectro Electromagnético - Análisis BotConf 2024'
                        },
                        legend: {
                            position: 'bottom'
                        }
                    },
                    scales: {
                        y: {
                            title: {
                                display: true,
                                text: 'Potencia (dBm)'
                            },
                            grid: {
                                color: 'rgba(0,0,0,0.1)'
                            }
                        },
                        x: {
                            title: {
                                display: true,
                                text: 'Frecuencia'
                            },
                            grid: {
                                color: 'rgba(0,0,0,0.1)'
                            }
                        }
                    },
                    animation: {
                        duration: 1000,
                        easing: 'easeInOutQuart'
                    }
                }
            });
        }

        // Update EM data in real-time
        function updateEMData() {
            // Simulate real-time EM detection data
            const confidence = (92 + Math.random() * 6).toFixed(1);
            const rfLow = (-45 + Math.random() * 6).toFixed(1);
            const rfMid = (-40 + Math.random() * 8).toFixed(1);
            const rfHigh = (-47 + Math.random() * 4).toFixed(1);

            if (document.getElementById('emConfidence')) {
                document.getElementById('emConfidence').textContent = confidence + '%';
                document.getElementById('rfLow').textContent = rfLow + ' dBm';
                document.getElementById('rfMid').textContent = rfMid + ' dBm';
                document.getElementById('rfHigh').textContent = rfHigh + ' dBm';
            }

            // Update statistics
            const totalScans = 2847 + Math.floor(Math.random() * 10);
            const threatsDetected = Math.floor(Math.random() * 5);
            const falsePositives = (0.1 + Math.random() * 0.3).toFixed(1);
            const responseTime = (0.6 + Math.random() * 0.4).toFixed(1);

            if (document.getElementById('totalScans')) {
                document.getElementById('totalScans').textContent = totalScans.toLocaleString();
                document.getElementById('threatsDetected').textContent = threatsDetected;
                document.getElementById('falsePositives').textContent = falsePositives + '%';
                document.getElementById('avgResponseTime').textContent = responseTime + 's';
            }

            // Simulate anomalous signature detection occasionally
            if (Math.random() < 0.1) {
                const anomalousSignature = document.getElementById('anomalousSignature');
                if (anomalousSignature) {
                    anomalousSignature.style.display = 'flex';
                    showNotification('🔬 BotConf: Patrón electromagnético anómalo detectado', 'warning');
                }
            }

            // Update EM spectrum chart if exists
            if (charts.emSpectrum) {
                // Generate new random data
                const newData = charts.emSpectrum.data.datasets[1].data.map(value =>
                    value + (Math.random() - 0.5) * 2
                );
                charts.emSpectrum.data.datasets[1].data = newData;
                charts.emSpectrum.update('none');
            }
        }

        console.log('🎨 SmartCompute Visual Dashboard con BotConf 2024 - Listo para acción');
    </script>
</body>
</html>